<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Diatonic Flashcards (All Degrees)</title>
<style>
  body { font-family: system-ui, sans-serif; max-width: 680px; margin: 40px auto; padding: 0 16px; }
  .card { border: 1px solid #ddd; border-radius: 14px; padding: 20px; }
  h1 { font-size: 18px; margin-bottom: 10px; }
  select, button { font-size: 16px; padding: 10px; margin-top: 10px; }
  .q { font-size: 24px; margin-top: 14px; white-space: pre-line; }
  .a { font-size: 24px; margin-top: 14px; visibility: hidden; }
  .err { font-size: 14px; margin-top: 10px; color: #b00020; white-space: pre-line; }
</style>
</head>
<body>
<div class="card">
  <h1>ダイアトニック・フラッシュカード</h1>

  <label for="keySelect">キー選択</label><br>
  <select id="keySelect">
    <option value="ALL">全キー</option>
    <option value="F">F</option>
    <option value="C">C</option>
    <option value="G">G</option>
    <option value="D">D</option>
    <option value="A">A</option>
    <option value="E">E</option>
    <option value="B">B</option>
    <option value="Gb">Gb</option>
    <option value="Db">Db</option>
    <option value="Ab">Ab</option>
    <option value="Eb">Eb</option>
    <option value="Bb">Bb</option>
  </select>

  <div class="q" id="question"></div>
  <div class="a" id="answer"></div>
  <div class="err" id="error"></div>

  <!-- ボタンは常に1つ -->
  <button id="actionBtn" onclick="action()">答え</button>
</div>

<script>
  const circleKeys = ["F","C","G","D","A","E","B","Gb","Db","Ab","Eb","Bb"];

  const table = {
    F:  ["F","Gm","Am","Bb","C","Dm","Edim"],
    C:  ["C","Dm","Em","F","G","Am","Bdim"],
    G:  ["G","Am","Bm","C","D","Em","F#dim"],
    D:  ["D","Em","F#m","G","A","Bm","C#dim"],
    A:  ["A","Bm","C#m","D","E","F#m","G#dim"],
    E:  ["E","F#m","G#m","A","B","C#m","D#dim"],
    B:  ["B","C#m","D#m","E","F#","G#m","A#dim"],
    Gb: ["Gb","Abm","Bbm","Cb","Db","Ebm","Fdim"],
    Db: ["Db","Ebm","Fm","Gb","Ab","Bbm","Cdim"],
    Ab: ["Ab","Bbm","Cm","Db","Eb","Fm","Gdim"],
    Eb: ["Eb","Fm","Gm","Ab","Bb","Cm","Ddim"],
    Bb: ["Bb","Cm","Dm","Eb","F","Gm","Adim"]
  };

  const degrees = ["I","ii","iii","IV","V","vi","vii°"];

  let currentKey = null;
  let currentDegree = null;
  let revealed = false; // いま答え表示中か

  function pickKey() {
    const sel = document.getElementById("keySelect").value;
    if (sel === "ALL") return circleKeys[Math.floor(Math.random() * circleKeys.length)];
    return sel;
  }

  function nextCard() {
    currentKey = pickKey();
    currentDegree = Math.floor(Math.random() * 7);

    document.getElementById("question").textContent =
      `Key: ${currentKey} Major\n${degrees[currentDegree]} は何？`;

    const row = table[currentKey];
    const errEl = document.getElementById("error");
    errEl.textContent = "";

    if (!row) {
      document.getElementById("answer").textContent = "";
      errEl.textContent = `ERROR: table にキー「${currentKey}」がありません。`;
    } else if (row[currentDegree] === undefined) {
      document.getElementById("answer").textContent = "";
      errEl.textContent = `ERROR: table[${currentKey}] に度数 index ${currentDegree} がありません。`;
    } else {
      document.getElementById("answer").textContent = row[currentDegree];
    }

    // 初期状態：答えは隠す／ボタンは「答え」
    revealed = false;
    document.getElementById("answer").style.visibility = "hidden";
    document.getElementById("actionBtn").textContent = "答え";
  }

  function action() {
    // まだ隠れている → 表示してボタンを「次へ」に
    if (!revealed) {
      document.getElementById("answer").style.visibility = "visible";
      revealed = true;
      document.getElementById("actionBtn").textContent = "次へ";
      return;
    }
    // 表示中 → 次のカードへ
    nextCard();
  }

  nextCard();
</script>
</body>
</html>
